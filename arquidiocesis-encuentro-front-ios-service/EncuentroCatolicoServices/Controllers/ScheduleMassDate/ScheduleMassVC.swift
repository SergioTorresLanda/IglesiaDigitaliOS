//
//  ScheduleMassViewController.swift
//  EncuentroCatolicoServices
//
//  Created Desarrollo on 28/04/21.
//  Copyright © 2021 ___ORGANIZATIONNAME___. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit

class ScheduleMassViewController: UIViewController, ScheduleMassViewProtocol {
    
    var presenter: ScheduleMassPresenterProtocol?
    var location: Assigned!
    let alert = UIAlertController(title: "", message: "\n \n \n \n \nCargando...", preferredStyle: .alert)
    let viewBundle = Bundle.init(identifier: "mx.arquidiocesis.EncuentroCatolicoServices")
    let loc =  Locale(identifier: "es_MX")
    
    @IBOutlet weak var datePicker: UIDatePicker!
    @IBOutlet weak var lblTitle  : UILabel!
    @IBOutlet weak var imgChurch: UIImageView!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        showLoading()
        initUI()
        datePicker.minimumDate = Date()
        datePicker.locale = loc
        datePicker.addTarget(self, action: #selector(dateChanged(_:)), for: .valueChanged)
    }
    
    override func viewWillAppear(_ animated: Bool) {
        print("VC ECServices - ScheduleMassDateVC ")

    }
    
    func initUI() {
        hideLoading()
        lblTitle.text = location.name
        
        if let url = URL(string: location.image_url ?? "") {
            imgChurch.load(url: url)
        }
    }
    
    func showLoading() {
        let imageView = UIImageView(frame: CGRect(x: 75, y: 25, width: 140, height: 60))
        imageView.image = UIImage(named: "logoEncuentro", in: viewBundle, compatibleWith: nil)
        alert.view.addSubview(imageView)
        self.present(alert, animated: false, completion: nil)
    }
    
    func hideLoading() {
        self.alert.dismiss(animated: false, completion: nil)
    }
    
    
    @objc func dateChanged(_ sender: UIDatePicker) {
        let view = ScheduleMassTimeRouter.createModule(date: datePicker.date, location: location)
        self.navigationController?.pushViewController(view, animated: true)
    }
    
    @IBAction func close(_ sender: Any){
        self.navigationController?.popViewController(animated: true)
    }
    
}
